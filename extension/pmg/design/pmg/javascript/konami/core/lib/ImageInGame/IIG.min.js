var IIG=IIG||{};IIG.ImageManager=function(){this._filenames=[];this._sprites=[];this._spritesInstances=[];this._nbImagesLoaded=0;this._callback=function(){};this.imagesLoaded=false};IIG.ImageManager.prototype={constructor:IIG.ImageManager,add:function(){if(arguments.length===1)this._filenames.push(arguments[0]);else if(arguments.length>1)for(var e=0,t=arguments.length;e<t;e++)this._filenames.push(arguments[e])},getInstance:function(e){var t=this._sprites[e];var n=new IIG.Image({data:t.data,width:t.width,height:t.height,animation:t.animation});this._spritesInstances.push(n);return n},killInstance:function(e){for(var t=0,n=this._spritesInstances.length;t<n;t++){if(this._spritesInstances[t]!==e)continue;this._spritesInstances[t].isDestroyed=true;delete this._spritesInstances[t].animation;this._spritesInstances.splice(t,1)}if(e instanceof IIG.Image){var r=[e];r.splice(0,1);e=r=undefined}return undefined},loadAll:function(e){if("function"===typeof e)this._callback=e;var t=this;for(var n=0,r=this._filenames.length;n<r;n++){var i=this._filenames[n];var s=new Image;s.src=i;s.onload=function(){t.loaded(this)};var o=/^(.*)\.(png|gif|jpg)$/ig.exec(i)[1];s.setAttribute("data-label",o);this._sprites[o]={data:s,width:0,height:0,animation:null}}},loaded:function(e){var t=e.getAttribute("data-label");this._sprites[t].width=e.width;this._sprites[t].height=e.height;if(++this._nbImagesLoaded===IIG.Utils.count(this._sprites)){this.imagesLoaded=true;this._callback()}},update:function(){var e,t,n=false,r,i;for(var s=0,o=this._spritesInstances.length;s<o;s++){if(!this._spritesInstances[s]instanceof IIG.Image)continue;e=this._spritesInstances[s];if(!(e.animation instanceof IIG.Animation&&(!e.animation.pauseAnimation||!e.pauseAnimation)))continue;if(e.animationDestroyed)e.animationDestroyed=false;t=e.animation;++t.frameCount;if(t.frameCount<t.animByFrame)continue;t.frameCount=0;if(t._resetAtNextState){n=true;t._resetAtNextState=false}if(t.animDirection==="ltr"||t.animDirection==="rtl"){r=t.startPoint||0;i=t.endPoint||e.width;t.sx+=t.sWidth*t._animDirectionMultiplier;if(t.alternate){if(t.sx<=r||t.sx+t.sWidth>=i){t._animDirectionMultiplier*=-1;t._resetAtNextState=true}}else{if(t.animDirection==="ltr"){if(t.sx>=i){t.sx=r;n=true}}else if(t.animDirection==="rtl"){if(t.sx<r){t.sx=i-t.sWidth;n=true}}}}else if(t.animDirection==="ttb"||t.animDirection==="btt"){r=t.startPoint||0;i=t.endPoint||e.height;t.sy+=t.sHeight*t._animDirectionMultiplier;if(t.alternate){if(t.sy<=r||t.sy+t.sHeight>=i){t._animDirectionMultiplier*=-1;t._resetAtNextState=true}}else{if(t.animDirection==="ttb"){if(t.sy>=i){t.sy=r;n=true}}else if(t.animDirection==="btt"){if(t.sy<r){t.sy=i-t.sHeight;n=true}}}}if(n){if("number"===typeof t.iterations){if(++t._iterationsCount>=t.iterations){this._spritesInstances[s].animation=t=undefined;this._spritesInstances[s].animationDestroyed=true}}n=false}}},drawImage:function(e,t,n,r){if(t.animation instanceof IIG.Animation)return e.drawImage(t.data,t.animation.sx,t.animation.sy,t.animation.sWidth,t.animation.sHeight,n,r,t.animation.sWidth,t.animation.sHeight);else return e.drawImage(t.data,n,r)}};IIG.Animation=function(e){this.frameCount=0;this.sx=0;this.sy=0;this.sWidth=0;this.sHeight=0;this.animDirection="ltr";this._animDirectionMultiplier=1;this.alternate=false;this.animByFrame=12;this.pauseAnimation=false;this.iterations="infinite";this._iterationsCount=0;this._resetAtNextState=false;this.startPoint=0;this.endPoint=0;if("object"===typeof e){this.sx=parseInt(e.sx)>0?e.sx:this.sx;this.sy=parseInt(e.sy)>0?e.sy:this.sy;this.sWidth=parseInt(e.sWidth)>0?e.sWidth:this.sWidth;this.sHeight=parseInt(e.sHeight)>0?e.sHeight:this.sHeight;if(e.animDirection){if(e.animDirection==="right2left"||e.animDirection==="left2right"||e.animDirection==="top2bottom"||e.animDirection==="bottom2top")console.warn("`ImageInGame` - Value '"+e.animDirection+"' is deprecated. Use instead 'rtl', 'ltr', 'ttb' or 'btt'");e.animDirection=e.animDirection==="right2left"?"rtl":e.animDirection;e.animDirection=e.animDirection==="left2right"?"ltr":e.animDirection;e.animDirection=e.animDirection==="top2bottom"?"ttb":e.animDirection;e.animDirection=e.animDirection==="bottom2top"?"btt":e.animDirection;if(e.animDirection==="rtl"||e.animDirection==="ltr"||e.animDirection==="ttb"||e.animDirection==="btt")this.animDirection=e.animDirection;this._animDirectionMultiplier=e.animDirection==="rtl"||e.animDirection==="btt"?-1:1}this.alternate=e.alternate||this.alternate;this.animByFrame=parseInt(e.animByFrame)>0?e.animByFrame:this.animByFrame;this.pauseAnimation=e.pauseAnimation||this.pauseAnimation;this.iterations=e.iterations||this.iterations;this.startPoint=e.startPoint||0;this.endPoint=e.endPoint||0;if(this.startPoint>0){if(this.animDirection==="ltr"||this.animDirection==="rtl")this.sx=this.startPoint;else if(this.animDirection==="ttb"||this.animDirection==="btt")this.sy=this.startPoint}}};IIG.Image=function(e){if("object"===typeof e){this.data=e.data;this.width=e.width;this.height=e.height;this.animation=e.animation;this.pauseAnimation=e.animation instanceof IIG.Animation?e.animation.pauseAnimation:false;this.animationDestroyed=false}};IIG.Utils={count:function(e){var t=0,n;for(n in e){if(e.hasOwnProperty(n))t++}return t}}